<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Baby Feed Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 0; 
      background: #f0f4f8; 
      padding: 15px; 
    }
    h1 { 
      color: #333; 
      text-align: center;
      margin-bottom: 10px;
    }
    #lastFed { 
      font-weight: bold; 
      color: #007BFF; 
      text-align: center; 
      font-size: 1.2em; 
      margin-bottom: 20px; 
    }
    form { 
      background: white; 
      padding: 15px; 
      border-radius: 10px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
      margin-bottom: 20px; 
    }
    label { 
      display: block; 
      margin-top: 15px; 
      font-weight: bold; 
    }
    select, button { 
      width: 100%; 
      padding: 12px; 
      font-size: 1em; 
      margin-top: 5px; 
      border-radius: 8px; 
      border: 1px solid #ccc; 
      box-sizing: border-box; 
    }
    button { 
      background: #007BFF; 
      color: white; 
      font-weight: bold; 
      border: none; 
      margin-top: 20px;
      cursor: pointer; 
    }
    button:hover { 
      background: #0056b3; 
    }
    h2 { 
      margin-top: 0; 
      margin-bottom: 10px;
    }
    #feedList { 
      display: flex; 
      flex-direction: column; 
      gap: 10px; 
    }
    .feed-entry { 
      background: white; 
      border-radius: 10px; 
      padding: 12px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .feed-entry strong {
      font-size: 1.1em;
      color: #333;
    }
    .feed-entry small {
      color: #777;
      font-size: 0.9em;
    }
  </style>
</head>
<body>

<h1>Baby Feed Tracker</h1>
<div id="lastFed">Last fed: —</div>

<form id="feedForm">
  <label>Feeding Type:
    <select id="feedingType" required>
      <option value="">Select...</option>
      <option value="Bottle">Bottle</option>
      <option value="Breast milk (bottle)">Breast milk (bottle)</option>
      <option value="Breast fed">Breast fed</option>
    </select>
  </label>

  <label>Baby's Mood:
    <select id="mood" required>
      <option value="">Select...</option>
      <option value="Happy">Happy</option>
      <option value="Easy">Easy</option>
      <option value="Struggling">Struggling</option>
      <option value="Didn't eat">Didn't eat</option>
    </select>
  </label>

  <button type="submit">Add Feed</button>
</form>

<h2>Feed History</h2>
<div id="feedList"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js"></script>

<script>
  // TODO: Replace with your Firebase project details
  const firebaseConfig = {
  apiKey: "AIzaSyBpEPACS_GPGQYYvGzFZW3nXEnNmGzTpQc",
  authDomain: "niko-s-feeding-tracker.firebaseapp.com",
  databaseURL: "https://niko-s-feeding-tracker-default-rtdb.firebaseio.com",
  projectId: "niko-s-feeding-tracker",
  storageBucket: "niko-s-feeding-tracker.firebasestorage.app",
  messagingSenderId: "905511735532",
  appId: "1:905511735532:web:e570c521ec91dee88895c9",
  measurementId: "G-HX96P43JNP"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const feedForm = document.getElementById('feedForm');
  const feedList = document.getElementById('feedList');
  const lastFedDisplay = document.getElementById('lastFed');

  let latestFeedTime = null;

  feedForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const feedingType = document.getElementById('feedingType').value;
    const mood = document.getElementById('mood').value;
    const timestamp = new Date().toISOString();

    db.ref('feeds').push({
      feedingType,
      mood,
      timestamp
    });

    feedForm.reset();
  });

  db.ref('feeds').on('value', (snapshot) => {
    const feeds = snapshot.val();
    feedList.innerHTML = '';
    if (feeds) {
      const sortedFeeds = Object.values(feeds)
        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

      sortedFeeds.forEach(feed => {
        const div = document.createElement('div');
        div.className = 'feed-entry';
        div.innerHTML = `<strong>${feed.feedingType}</strong> - ${feed.mood} <br>
                         <small>${new Date(feed.timestamp).toLocaleString()}</small>`;
        feedList.appendChild(div);
      });

      latestFeedTime = new Date(sortedFeeds[0].timestamp);
      updateLastFed(); // update immediately when data changes
    }
  });

  function updateLastFed() {
    if (latestFeedTime) {
      const diffMs = new Date() - latestFeedTime;
      const diffMins = Math.floor(diffMs / 60000);
      if (diffMins < 1) {
        lastFedDisplay.textContent = "Last fed: just now";
      } else if (diffMins < 60) {
        lastFedDisplay.textContent = `Last fed: ${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
      } else {
        const hours = Math.floor(diffMins / 60);
        const mins = diffMins % 60;
        lastFedDisplay.textContent = `Last fed: ${hours}h ${mins}m ago`;
      }
    } else {
      lastFedDisplay.textContent = "Last fed: —";
    }
  }

  setInterval(updateLastFed, 10000); // update every 10s
</script>

</body>
</html>
